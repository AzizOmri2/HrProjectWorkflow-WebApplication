<div class="container">

    <!-- Wait Modal -->
    <div *ngIf="isLoadingRecommendations" class="loading-backdrop">
        <div class="loading-modal">
            <div class="spinner"></div>
            <p>üîç Generating personalized job recommendations...<br>Please hold on.</p>
        </div>
    </div>

    <div class="container" *ngIf="isCandidateConnected">
        <section *ngIf="recommendedOffers.length > 0" class="recommended-section">
            <h4 class="section-title">üéØ Recommended Job Offers For You</h4>
            <div class="card-grid">
                <div *ngFor="let offer of recommendedOffers" class="offer-card">
                    <div class="card-header">
                        <h5 class="offer-title">
                            <b>{{ offer.title }}</b>
                        </h5>
                    </div>
                    <div class="card-body">
                        <p class="offer-reason">{{ offer.match_reason }}</p>
                        <a [routerLink]="['/front/offers/show', offer.id]"
                            class="btn btn-primary btn-block show-details-btn">
                            Show Details
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- Optional fallback -->
        <section *ngIf="recommendedOffers.length === 0 && isCandidateConnected" class="no-recommendation-container">
            <div class="no-recommendation-card">
                <!-- Show appropriate icon -->
                <i *ngIf="!recommendationErrorMessage" class="fas fa-search fa-3x icon"></i>
                <i *ngIf="recommendationErrorMessage" class="fas fa-exclamation-triangle fa-3x icon danger-icon"></i>

                <!-- Message block for errors -->
                <div *ngIf="recommendationErrorMessage; else noRecommendationsTitle">
                    <!-- Profile Incomplete Case -->
                    <h3 *ngIf="recommendationErrorMessage.includes('incomplete')">
                        Complete Your Profile
                    </h3>
                    <!-- Too Many Requests Case -->
                    <h3 *ngIf="recommendationErrorMessage.includes('too many requests')">
                        Too Many Requests
                    </h3>
                    <!-- Display actual message -->
                    <p>{{ recommendationErrorMessage }}</p>
                </div>

                <!-- Default fallback when no error -->
                <ng-template #noRecommendationsTitle>
                    <h3>No Recommendations Yet!</h3>
                    <p>
                        We‚Äôre still learning about your skills and preferences. Complete your profile to help us recommend the best job opportunities for you.
                    </p>
                </ng-template>
            </div>
        </section>
    </div>
    


    <div class="right-section">
        <h1>Gain in Efficiency</h1>
        <p>
            Let your favorite job slip away? Never again! <br>In your personal space, manage your job 
            search, centralize all your applications, and compare jobs. <br>Thanks to our personalized 
            alerts, be the first to apply. <br>Keep track of your application status and get notified 
            about scheduling your interviews ‚Äî all in one place for a smoother hiring experience.
        </p>
        <div class="btn-group">
            <button class="btn" [routerLink]="['/front/applications/mes-applications']">Track my applications</button>
            <a [routerLink]="isCandidateConnected ? '/front/about' : '/frontvisiteur/about'" class="btn" style="background: transparent; color: #2878EB; border: 1px solid #2878EB; margin-left: 10px;">
                For More
            </a>
        </div>
    </div>

    <div class="left-section">
        <div class="job-card">
            <h3>Applications Management</h3>
            <div class="card-grid">
                <div class="card-item">MY APPLICATIONS <span style="color: #f0c000;"><strong>{{ apps_count }}</strong></span></div>
                <div class="card-item">INTERVIEWS <span style="color: #f0c000;"><strong>{{ interviews_count }}</strong></span></div>
            </div>
            <div class="company-preview shadow">
                <div>Job Offer : <b>{{ mes_apps[0].job_offer.title }}</b></div>
                <div [ngSwitch]="mes_apps[0].status">
                    <span *ngSwitchCase="'Interviewed'" class="label label-info">Interviewed</span>
                    <span *ngSwitchCase="'Accepted'" class="label label-success">Accepted</span>
                    <span *ngSwitchCase="'Pending'" class="label label-warning">Pending</span>
                    <span *ngSwitchCase="'Rejected'" class="label label-danger">Rejected</span>
                    <span *ngSwitchCase="'Withdrawn'" class="label label-default">Withdrawn</span>
                    <span *ngSwitchDefault class="label label-default">APPLY NOW</span>
                </div>
            </div>
        </div>

        <!-- Recruiter Card -->
        <div class="job-card">
            <div class="company-preview">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                    <img [src]="'http://localhost:3000/' + userImage" alt="Candidate" style="width: 40px; height: 40px; border-radius: 50%;">
                    <div>
                        <div style="font-weight: 600;">Candidate</div>
                        <div style="font-size: 14px;">{{ userName }}</div>
                    </div>
                </div>
                <div style="font-weight: bold; margin-bottom: 10px;">Job Applications</div>
                    <div style="display: flex; gap: 15px;">
                    <button class="filter-button">‚úÖ Accepted</button>
                    <button class="filter-button">üìù Interviewed</button>
                    <button class="filter-button">‚ùå Rejected</button>
                    <button class="filter-button">üè≥Ô∏è Whithdrawn</button>
                </div>
            </div>
        </div>
    </div>
</div>

<br><br><br><br>

<div class="container">
    <div class="left-section">
        <div class="job-card">
            <div style="display:flex; align-items:center;">
                <h3>
                    <strong>Jobs</strong>
                </h3>
                <span class="badge">{{ offers_count }}</span>
            </div>

            <!-- Gray horizontal line -->
            <hr style="border: none; border-top: 1px solid #ccc; margin: 0px 0;" />
            
            <div *ngIf="recommendedOffers.length > 0; else noRecommendations" style="display: flex; justify-content: space-between; align-items: center;">
                <h3>{{ recommendedOffers[0]?.title || 'Default Job' }}</h3>
                <button class="btn more-details-btn" [routerLink]="['/front/offers/show', recommendedOffers[0]?.id]">Apply Now</button>
            </div>

            <ng-template #noRecommendations>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3>{{ mes_apps[0]?.offer?.title || 'Default Job' }}</h3>
                    <button class="btn more-details-btn" [routerLink]="['/front/offers/show', mes_apps[0]?.offer?.id]">Apply Now</button>
                </div>
            </ng-template>
            <p style="color: green;">
                <strong>üî• This opportunity matches your profile!</strong>
            </p>
        </div>
        <div class="filters">
            <img style="width:250px;" src="logo-hrproject-workflow.png">
        </div>
    </div>

    <div class="right-section">
        <h1>Step Behind the Scenes</h1>
        <p>
            Go beyond job offers and discover the skills, values, and experience 
            level behind each one. <br>Get a real sense of where you‚Äôre applying, meet
            your future team, and find a workplace where you truly belong. <br>Learn what
            to expect at each step of the hiring process, from initial contact to final 
            interview <strong>to prepare with confidence.</strong>
        </p>
        <button class="btn" [routerLink]="isCandidateConnected ? '/front/offers' : '/frontvisiteur/offers'">Find a job</button>
    </div>
</div>



<br><br><br><br>

<!-- Added title for articles and actualities -->
<div class="articles-title">
    <h1>Articles & Actualities</h1>
</div>


<div class="articles-container">
    <div *ngFor="let article of articles" class="article-card">
        <h2>
            <strong>{{ article.title }}</strong>
        </h2>
        <img [src]="'http://localhost:3000/' + article.image" alt="Article image" />
        <br><br>
        <p>{{ article.content | slice:0:324 }}...</p>
        <div class="btn-container">
            <button [routerLink]="[isCandidateConnected ? '/front/articles/show' : '/frontvisiteur/articles/show', article.id]" 
                class="btn more-details-btn">
                More Details
            </button>
        </div>
    </div>
</div>